<!doctype html>
<head xmlns="http://www.w3.org/1999/html">
        <title>Chip 8 Emulator</title>
    </head>
    <link href='http://fonts.googleapis.com/css?family=Press+Start+2P' rel='stylesheet' type='text/css'>

    <style>

        body {
            font-family: sans-serif;
            font-size: 80%;
        }

        h1 {
            font-family: "Press Start 2P", sans-serif;
        }

        canvas {
            position: relative;
            border: 1px solid #ccc;
            background: #000;
        }
		
		label::after {
			content: ":";
		}
		
		p,
		p a {
			color: #444;
		}
		
		ol {
			width: 120px;
			list-style: none;
			padding: 0;
		}
		
		ol li {
			display: inline-block;
			margin: 0 8px 8px 0;

		}
		
		ol li kbd {
			padding: 2px 6px;
			background: #efefef;
			border-radius: 3px;
			font-size: 12px;
			box-shadow: 1px 1px 1px #ddd;
		}

    </style>

    <body>

        <h1>Chip-8 Emulator</h1>


        <form action="" id="loader">
			<label for="program">Program</label>
            <select id="program"><option></option></select>
            <button type="submit">Load</button>
        </form>

	    <canvas></canvas>
		
		<p>Chip-8 uses a hexadecimal input. Use the keys below.</p>
		
		<ol>
			<li><kbd title="0">1</kbd></li>
			<li><kbd title="1">2</kbd></li>
			<li><kbd title="2">3</kbd></li>
			<li><kbd title="3">4</kbd></li>
			<li><kbd title="4">Q</kbd></li>
			<li><kbd title="5">W</kbd></li>
			<li><kbd title="6">E</kbd></li>
			<li><kbd title="7">R</kbd></li>
			<li><kbd title="8">A</kbd></li>
			<li><kbd title="9">S</kbd></li>
			<li><kbd title="0">D</kbd></li>
			<li><kbd title="A">F</kbd></li>
			<li><kbd title="B">Z</kbd></li>
			<li><kbd title="C">X</kbd></li>
			<li><kbd title="D">C</kbd></li>
			<li><kbd title="E">V</kbd></li>
		</ol>
		
        <p>
			By <a href="http://alexanderdickson.com">Alex Dickson</a>. Based on <a href="http://devernay.free.fr/hacks/chip8/C8TECH10.HTM">Cowgod's Chip-8 Technical Reference</a>.
		</p>

        <script src="scripts/polyfills.js"></script>
        <script src="scripts/renderer.js"></script>
        <script src="scripts/chip8.js"></script>
        <script>
            (function() {

                var ch = new Chip8;

                ch.setRenderer(new CanvasRenderer(document.getElementsByTagName("canvas")[0], ch.getDisplayWidth(), ch.getDisplayHeight(), 16));

                var form = document.querySelector("#loader"),
                    select = form.querySelector("#program");

                var roms = ["15PUZZLE", "BLINKY", "BLITZ", "BRIX", "CONNECT4", "GUESS", "HIDDEN", "IBM", "INVADERS", "KALEID", "MAZE", "MERLIN", "MISSILE", "PONG", "PONG2", "PUZZLE", "SYZYGY", "TANK", "TETRIS", "TICTAC", "UFO", "VBRIX", "VERS", "WIPEOFF"];

                roms.forEach(function(rom) {
                    var option = document.createElement("option");
                    option.textContent = rom;
                    select.add(option);
                });

                form.addEventListener("submit", function(event) {
                    event.preventDefault();

                    var value = select.value;

                    if ( ! value) {
                        alert("Please select a ROM.");
                        return;
                    }

                    // Load program.
                    var xhr = new XMLHttpRequest();
                    xhr.open("GET", "roms/" + value, true);
                    xhr.responseType = "arraybuffer";

                    xhr.onload = function () {
                        ch.stop();
                        ch.reset();
                        ch.loadProgram(new Uint8Array(xhr.response));
                        ch.start();
                    };

                    xhr.send();

                });

                // Key handling.
                var translateKeys = {
                    49: 0x1,  // 1
                    50: 0x2,  // 2
                    51: 0x3,  // 3
                    52: 0x4,  // 4
                    81: 0x5,  // Q
                    87: 0x6,  // W
                    69: 0x7,  // E
                    82: 0x8,  // R
                    65: 0x9,  // A
                    83: 0xA,  // S
                    68: 0xB,  // D
                    70: 0xC,  // F
                    90: 0xD,  // Z
                    88: 0xE,  // X
                    67: 0xF,  // C
                    86: 0x10  // V
                };

                document.addEventListener("keydown", function(event) {
                    ch.setKey(translateKeys[event.keyCode]);
                });

                document.addEventListener("keyup", function(event) {
                    ch.unsetKey(translateKeys[event.keyCode]);
                });

            })();
        </script>

    </body>
</html>
